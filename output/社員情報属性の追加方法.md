# ç¤¾å“¡æƒ…å ±å±æ€§ã®è¿½åŠ æ–¹æ³•

## 1. attributesã®æŸ”è»Ÿæ€§

`attributes`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ **å®Œå…¨ã«æ‹¡å¼µå¯èƒ½** ã§ã€ä»»æ„ã®å±æ€§ã‚’è¿½åŠ ã§ãã¾ã™ã€‚ã“ã‚Œã¯LDAPã®æ¨™æº–çš„ãªä½¿ç”¨æ–¹æ³•ã§ã™ã€‚

## 2. ç¤¾å“¡æƒ…å ±ã®å±æ€§ä¾‹

### 2.1 æ¨å¥¨ã™ã‚‹ç¤¾å“¡å±æ€§

ä»¥ä¸‹ã®å±æ€§ã‚’`attributes`ã«è¿½åŠ ã§ãã¾ã™ï¼š

| å±æ€§å | èª¬æ˜ | ä¾‹ | LDAPæ¨™æº– |
|--------|------|-----|----------|
| `department` | éƒ¨ç½² | `"å–¶æ¥­éƒ¨"` | âœ… |
| `division` | éƒ¨é–€ãƒ»äº‹æ¥­éƒ¨ | `"æ±äº¬æœ¬ç¤¾"` | âŒ (ã‚«ã‚¹ã‚¿ãƒ ) |
| `employeeNumber` | ç¤¾å“¡ç•ªå· | `"EMP001234"` | âœ… |
| `mobile` | ä¼šç¤¾æºå¸¯ç•ªå· | `"080-1234-5678"` | âœ… |
| `title` | å½¹è· | `"èª²é•·"` | âœ… |
| `manager` | ä¸Šå¸ã®DN | `"cn=ç”°ä¸­éƒ¨é•·,ou=users,dc=example,dc=com"` | âœ… |
| `physicalDeliveryOfficeName` | ã‚ªãƒ•ã‚£ã‚¹ãƒ»æ‹ ç‚¹ | `"æ±äº¬æœ¬ç¤¾"` | âœ… |
| `postalAddress` | ä½æ‰€ | `"æ±äº¬éƒ½åƒä»£ç”°åŒº..."` | âœ… |
| `employeeType` | é›‡ç”¨å½¢æ…‹ | `"æ­£ç¤¾å“¡"`, `"å¥‘ç´„ç¤¾å“¡"` | âœ… |
| `costCenter` | ã‚³ã‚¹ãƒˆã‚»ãƒ³ã‚¿ãƒ¼ | `"CC-001"` | âŒ (ã‚«ã‚¹ã‚¿ãƒ ) |

### 2.2 å®Ÿè£…ä¾‹

#### æ‹¡å¼µã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿

```json
{
  "users": {
    "tanaka.taro@company.com": {
      "dn": "mail=tanaka.taro@company.com,ou=users,dc=company,dc=com",
      "password": "$2b$10$ãƒãƒƒã‚·ãƒ¥åŒ–ã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰...",
      "attributes": {
        // åŸºæœ¬æƒ…å ±
        "mail": "tanaka.taro@company.com",
        "cn": "ç”°ä¸­å¤ªéƒ",
        "givenName": "å¤ªéƒ",
        "sn": "ç”°ä¸­",
        "role": "employee",
        
        // ç¤¾å“¡æƒ…å ±
        "employeeNumber": "EMP001234",
        "department": "å–¶æ¥­éƒ¨",
        "division": "æ±äº¬æœ¬ç¤¾",
        "title": "å–¶æ¥­èª²é•·",
        "manager": "cn=ä½è—¤éƒ¨é•·,ou=users,dc=company,dc=com",
        "employeeType": "æ­£ç¤¾å“¡",
        
        // é€£çµ¡å…ˆæƒ…å ±
        "telephoneNumber": "03-1234-5678",
        "mobile": "080-1234-5678",
        "physicalDeliveryOfficeName": "æ±äº¬æœ¬ç¤¾",
        "postalAddress": "æ±äº¬éƒ½åƒä»£ç”°åŒºä¸¸ã®å†…1-1-1",
        
        // ã‚«ã‚¹ã‚¿ãƒ å±æ€§
        "costCenter": "CC-SALES-001",
        "hireDate": "2020-04-01",
        "jobCode": "SALES-MGR",
        
        // LDAP objectClass
        "objectClass": [
          "inetOrgPerson",
          "organizationalPerson", 
          "person",
          "top",
          "employee"
        ]
      }
    },
    "yamada.hanako@company.com": {
      "dn": "mail=yamada.hanako@company.com,ou=users,dc=company,dc=com",
      "password": "$2b$10$ãƒãƒƒã‚·ãƒ¥åŒ–ã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰...",
      "attributes": {
        // åŸºæœ¬æƒ…å ±
        "mail": "yamada.hanako@company.com",
        "cn": "å±±ç”°èŠ±å­",
        "givenName": "èŠ±å­",
        "sn": "å±±ç”°",
        "role": "employee",
        
        // ç¤¾å“¡æƒ…å ±
        "employeeNumber": "EMP005678",
        "department": "äººäº‹éƒ¨",
        "division": "ç®¡ç†æœ¬éƒ¨",
        "title": "äººäº‹æ‹…å½“",
        "manager": "cn=éˆ´æœ¨éƒ¨é•·,ou=users,dc=company,dc=com",
        "employeeType": "æ­£ç¤¾å“¡",
        
        // é€£çµ¡å…ˆæƒ…å ±
        "telephoneNumber": "03-1234-5679",
        "mobile": "080-5678-9012",
        "physicalDeliveryOfficeName": "æ±äº¬æœ¬ç¤¾",
        
        // ã‚«ã‚¹ã‚¿ãƒ å±æ€§
        "costCenter": "CC-HR-001",
        "hireDate": "2019-07-15",
        "jobCode": "HR-SPEC",
        "certifications": ["äººäº‹åŠ´å‹™ç®¡ç†å£«", "ç¤¾ä¼šä¿é™ºåŠ´å‹™å£«"]
      }
    }
  }
}
```

## 3. å®Ÿè£…æ–¹æ³•

### 3.1 UserManagerã®æ‹¡å¼µ

ç¾åœ¨ã®`UserManager`ã¯æ—¢ã«æŸ”è»Ÿãª`attributes`ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚è¿½åŠ ã®å®Ÿè£…ã¯ä¸è¦ã§ã™ï¼š

```javascript
// ç¤¾å“¡æƒ…å ±ã‚’å«ã‚€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¿½åŠ 
await userManager.addUser('tanaka.taro@company.com', 'password123', {
  cn: 'ç”°ä¸­å¤ªéƒ',
  givenName: 'å¤ªéƒ',
  sn: 'ç”°ä¸­',
  role: 'employee',
  
  // ç¤¾å“¡æƒ…å ±ã‚’è¿½åŠ 
  employeeNumber: 'EMP001234',
  department: 'å–¶æ¥­éƒ¨',
  division: 'æ±äº¬æœ¬ç¤¾',
  title: 'å–¶æ¥­èª²é•·',
  mobile: '080-1234-5678',
  employeeType: 'æ­£ç¤¾å“¡',
  hireDate: '2020-04-01'
});
```

### 3.2 WebUIã§ã®ç¤¾å“¡æƒ…å ±ç®¡ç†

#### ãƒ•ã‚©ãƒ¼ãƒ æ‹¡å¼µä¾‹

```typescript
const [newUser, setNewUser] = useState({
  // åŸºæœ¬æƒ…å ±
  email: '',
  password: '',
  cn: '',
  givenName: '',
  sn: '',
  role: 'employee',
  
  // ç¤¾å“¡æƒ…å ±
  employeeNumber: '',
  department: '',
  division: '',
  title: '',
  manager: '',
  employeeType: 'æ­£ç¤¾å“¡',
  
  // é€£çµ¡å…ˆ
  telephoneNumber: '',
  mobile: '',
  physicalDeliveryOfficeName: '',
  
  // ã‚«ã‚¹ã‚¿ãƒ 
  costCenter: '',
  hireDate: ''
});
```

#### è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä¾‹

```jsx
// ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°è¡¨ç¤º
<div className="employee-info">
  <h3>ç¤¾å“¡æƒ…å ±</h3>
  <p>ç¤¾å“¡ç•ªå·: {user.attributes.employeeNumber}</p>
  <p>éƒ¨ç½²: {user.attributes.department}</p>
  <p>éƒ¨é–€: {user.attributes.division}</p>
  <p>å½¹è·: {user.attributes.title}</p>
  <p>é›‡ç”¨å½¢æ…‹: {user.attributes.employeeType}</p>
  <p>å…¥ç¤¾æ—¥: {user.attributes.hireDate}</p>
  <p>ä¼šç¤¾æºå¸¯: {user.attributes.mobile}</p>
</div>
```

## 4. æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½

### 4.1 éƒ¨ç½²åˆ¥æ¤œç´¢

```javascript
// UserManagerã®æ¤œç´¢æ©Ÿèƒ½ã‚’ä½¿ç”¨
const salesUsers = userManager.searchUsers({
  department: 'å–¶æ¥­éƒ¨'
});

const managementUsers = userManager.searchUsers({
  title: 'èª²é•·'
});
```

### 4.2 é«˜åº¦ãªæ¤œç´¢ä¾‹

```javascript
// è¤‡æ•°æ¡ä»¶ã§ã®æ¤œç´¢
class ExtendedUserManager extends UserManager {
  // éƒ¨ç½²ã¨ãƒ­ãƒ¼ãƒ«ã§ã®æ¤œç´¢
  searchByDepartmentAndRole(department, role) {
    return this.searchUsers({
      department: department,
      role: role
    });
  }
  
  // å…¥ç¤¾å¹´ã§ã®æ¤œç´¢
  searchByHireYear(year) {
    const users = this.getAllUsers();
    return Object.entries(users)
      .filter(([email, user]) => {
        const hireDate = user.attributes.hireDate;
        return hireDate && hireDate.startsWith(year);
      })
      .map(([email, user]) => ({
        email,
        dn: user.dn,
        attributes: user.attributes
      }));
  }
  
  // ç®¡ç†è€…ã®éƒ¨ä¸‹ä¸€è¦§
  getSubordinates(managerDn) {
    const users = this.getAllUsers();
    return Object.entries(users)
      .filter(([email, user]) => user.attributes.manager === managerDn)
      .map(([email, user]) => ({
        email,
        dn: user.dn,
        attributes: user.attributes
      }));
  }
}
```

## 5. APIæ‹¡å¼µä¾‹

### 5.1 éƒ¨ç½²ç®¡ç†API

```javascript
// app/api/ldap/departments/route.js
export async function GET() {
  const userManager = new UserManager();
  const users = userManager.getAllUsers();
  
  // éƒ¨ç½²ä¸€è¦§ã‚’å–å¾—
  const departments = [...new Set(
    Object.values(users)
      .map(user => user.attributes.department)
      .filter(Boolean)
  )];
  
  return NextResponse.json({
    success: true,
    departments: departments.sort()
  });
}
```

### 5.2 çµ„ç¹”å›³API

```javascript
// app/api/ldap/organization/route.js
export async function GET() {
  const userManager = new UserManager();
  const users = userManager.getAllUsers();
  
  // éƒ¨é–€ãƒ»éƒ¨ç½²åˆ¥ã®çµ„ç¹”æ§‹é€ ã‚’æ§‹ç¯‰
  const organization = {};
  
  Object.entries(users).forEach(([email, user]) => {
    const division = user.attributes.division || 'æœªåˆ†é¡';
    const department = user.attributes.department || 'æœªåˆ†é¡';
    
    if (!organization[division]) {
      organization[division] = {};
    }
    if (!organization[division][department]) {
      organization[division][department] = [];
    }
    
    organization[division][department].push({
      email,
      name: user.attributes.cn,
      title: user.attributes.title,
      employeeNumber: user.attributes.employeeNumber
    });
  });
  
  return NextResponse.json({
    success: true,
    organization
  });
}
```

## 6. åˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®æ‹¡å¼µ

```javascript
// scripts/init-company-users.js
const testEmployees = [
  {
    email: 'ceo@company.com',
    password: 'ceo123',
    attributes: {
      cn: 'ä»£è¡¨å–ç· å½¹',
      givenName: 'ç¤¾é•·',
      sn: 'ç”°ä¸­',
      role: 'admin',
      employeeNumber: 'CEO001',
      department: 'çµŒå–¶é™£',
      division: 'æœ¬ç¤¾',
      title: 'ä»£è¡¨å–ç· å½¹ç¤¾é•·',
      employeeType: 'å½¹å“¡',
      telephoneNumber: '03-1234-0001',
      mobile: '080-0001-0001'
    }
  },
  {
    email: 'sales.manager@company.com',
    password: 'sales123',
    attributes: {
      cn: 'å–¶æ¥­éƒ¨é•·',
      givenName: 'éƒ¨é•·',
      sn: 'ä½è—¤',
      role: 'manager',
      employeeNumber: 'MGR001',
      department: 'å–¶æ¥­éƒ¨',
      division: 'å–¶æ¥­æœ¬éƒ¨',
      title: 'å–¶æ¥­éƒ¨é•·',
      manager: 'cn=ä»£è¡¨å–ç· å½¹,ou=users,dc=company,dc=com',
      employeeType: 'æ­£ç¤¾å“¡',
      telephoneNumber: '03-1234-0002',
      mobile: '080-0002-0002'
    }
  }
];
```

## 7. ã¾ã¨ã‚

### âœ… å¯èƒ½ãªã“ã¨

- **ä»»æ„ã®å±æ€§è¿½åŠ **: `attributes`ã«è‡ªç”±ã«è¿½åŠ 
- **LDAPæ¨™æº–æº–æ‹ **: æ¨™æº–å±æ€§ã®æ´»ç”¨
- **ã‚«ã‚¹ã‚¿ãƒ å±æ€§**: ä¼šç¤¾å›ºæœ‰ã®å±æ€§
- **éšå±¤æ§‹é€ **: éƒ¨é–€ãƒ»éƒ¨ç½²ãƒ»ãƒãƒ¼ãƒ æ§‹é€ 
- **æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿**: æ§˜ã€…ãªæ¡ä»¶ã§ã®æ¤œç´¢

### ğŸ”§ å®Ÿè£…ã®ãƒã‚¤ãƒ³ãƒˆ

1. **å±æ€§ã®å‘½å**: LDAPæ¨™æº–ã«æº–æ‹ æ¨å¥¨
2. **ãƒ‡ãƒ¼ã‚¿å‹**: æ–‡å­—åˆ—ã€é…åˆ—ã€æ—¥ä»˜ãªã©æŸ”è»Ÿã«å¯¾å¿œ
3. **æ¤œç´¢æ©Ÿèƒ½**: UserManagerã®æ—¢å­˜æ©Ÿèƒ½ã‚’æ´»ç”¨
4. **UIæ‹¡å¼µ**: ãƒ•ã‚©ãƒ¼ãƒ ã¨è¡¨ç¤ºç”»é¢ã®è¿½åŠ 

ç¾åœ¨ã®`attributes`æ§‹é€ ã¯éå¸¸ã«æŸ”è»Ÿã§ã€ç¤¾å“¡æƒ…å ±ã®ç®¡ç†ã«æœ€é©ã§ã™ã€‚è¿½åŠ ã®å®Ÿè£…ãªã—ã«ã€ã™ãã«ç¤¾å“¡å±æ€§ã‚’è¿½åŠ ã—ã¦æ´»ç”¨ã§ãã¾ã™ï¼